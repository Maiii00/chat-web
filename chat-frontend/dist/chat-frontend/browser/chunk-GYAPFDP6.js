import{Da as u,Ha as a,h as i,j as c,m as l,o as d,s as n,w as s,ya as p}from"./chunk-5X6O65AH.js";var g=class r{tokenKey="accessToken";refreshKey="refreshToken";http=s(p);router=s(u);getToken(){return localStorage.getItem(this.tokenKey)}getUsername(){let t=this.getToken();if(!t)return null;try{let e=t.split(".")[1],o=JSON.parse(atob(e));return console.log(o.sub),o.sub??null}catch(e){return console.error("Failed to decode JWT",e),null}}getUserId(){let t=this.getToken();if(!t)return null;try{let e=t.split(".")[1],o=JSON.parse(atob(e));return console.log(o.id),o.id??null}catch(e){return console.error("Failed to decode JWT",e),null}}isLoggedIn(){return!!this.getToken()}logout(){let t=this.getToken();t?this.http.post(`${a.apiBaseUrl}/users/logout`,{},{headers:{Authorization:`Bearer ${t}`}}).subscribe({next:()=>{console.log("\u5F8C\u7AEF\u767B\u51FA\u6210\u529F"),this.clearTokenAndRedirect()},error:e=>{console.warn("\u5F8C\u7AEF\u767B\u51FA\u5931\u6557",e),this.clearTokenAndRedirect()}}):this.clearTokenAndRedirect()}clearTokenAndRedirect(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.refreshKey),this.router.navigate(["/login"])}refreshAccessToken(t){return console.log("\u767C\u9001 refresh \u8ACB\u6C42\uFF0Ctoken:",t),this.http.post(`${a.apiBaseUrl}/users/refresh`,{refreshToken:t}).pipe(l(e=>e.accessToken),d(e=>(console.error("refresh \u5931\u6557",e),c(null))))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=n({token:r,factory:r.\u0275fac,providedIn:"root"})};var h=class r{messageCache=new Map;conversationUpdatedSubject=new i(void 0);conversationUpdated$=this.conversationUpdatedSubject.asObservable();notifyConversationUpdate(){this.conversationUpdatedSubject.next()}getMessages(t){return this.messageCache.get(t)||[]}setMessages(t,e){this.messageCache.set(t,e)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=n({token:r,factory:r.\u0275fac,providedIn:"root"})};export{g as a,h as b};
