import{a as y,b as $}from"./chunk-J7CTMRYQ.js";import{A as f,Da as S,Ga as I,Ha as m,I as c,M as v,Q as C,T as _,V as r,W as a,Y as M,Z as O,_ as w,ca as l,da as d,f as g,l as h,sa as b,ua as x,w as s,ya as P,z as u}from"./chunk-277JHPB5.js";function D(n,e){if(n&1){let t=M();r(0,"div",2),O("click",function(){let o=u(t).$implicit,p=w();return f(p.openChat(o.userId))}),r(1,"div",3)(2,"div",4),l(3),a(),r(4,"div",5),l(5),a()()()}if(n&2){let t=e.$implicit;c(3),d(t.username),c(2),d(t.lastMessage)}}var k=class n{chatState=s($);http=s(P);router=s(S);auth=s(y);sub=null;conversations=[];sender=null;ngOnInit(){this.loadConversations(),this.sub=this.chatState.conversationUpdated$.subscribe(()=>{this.loadConversations()})}loadConversations(){let e=this.auth.getUserId();e&&this.http.get(`${m.apiBaseUrl}/messages/chat-list`).subscribe(t=>g(this,null,function*(){let i=[];for(let o of t){let p=yield h(this.http.get(`${m.apiBaseUrl}/users/${o}`)),F=yield h(this.http.get(`${m.apiBaseUrl}/messages/history?user1=${e}&user2=${o}&page=0&size=1`));i.push({userId:o,username:p.username,lastMessage:F[0]?.content??""})}this.conversations=i}))}openChat(e){this.router.navigate(["/chat",e])}ngOnDestroy(){this.sub?.unsubscribe()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["app-chat-list"]],decls:4,vars:1,consts:[[1,"chat-list"],["class","chat-preview",3,"click",4,"ngFor","ngForOf"],[1,"chat-preview",3,"click"],[1,"chat-content"],[1,"chat-username"],[1,"chat-lastMessage"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"h2"),l(2,"\u804A\u5929\u5BA4"),a(),C(3,D,6,2,"div",1),a()),t&2&&(c(3),_("ngForOf",i.conversations))},dependencies:[x,b,I],styles:[".chat-list[_ngcontent-%COMP%]{padding:1rem;width:300px;border-right:1px solid #e2e8f0;background-color:#fefefe}.chat-list[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:1rem;color:#2d3748;font-weight:600}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]{padding:.75rem 1rem;border-radius:.5rem;margin-bottom:.5rem;background-color:#fff;cursor:pointer;transition:background .2s,box-shadow .2s}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]:hover{background-color:#edf2f7;box-shadow:0 2px 4px #0000000d}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;overflow:hidden}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]   .chat-username[_ngcontent-%COMP%]{font-weight:600;color:#2d3748;font-size:1rem}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]   .chat-lastMessage[_ngcontent-%COMP%]{font-size:.85rem;color:#718096;margin-top:.25rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:220px}"]})};export{k as a};
