import{a as I,b as y}from"./chunk-B3MERF6B.js";import{A as u,Da as P,Ga as S,I as c,M as f,Q as v,T as C,V as r,W as a,Y as _,Z as M,_ as O,ca as p,da as h,f as d,l as m,sa as w,ua as b,w as s,ya as x,z as g}from"./chunk-EQHXVX3R.js";function $(n,e){if(n&1){let t=_();r(0,"div",2),M("click",function(){let o=g(t).$implicit,l=O();return u(l.openChat(o.userId))}),r(1,"div",3)(2,"div",4),p(3),a(),r(4,"div",5),p(5),a()()()}if(n&2){let t=e.$implicit;c(3),h(t.username),c(2),h(t.lastMessage)}}var k=class n{chatState=s(y);http=s(x);router=s(P);auth=s(I);sub=null;conversations=[];sender=null;ngOnInit(){this.loadConversations(),this.sub=this.chatState.conversationUpdated$.subscribe(()=>{this.loadConversations()})}loadConversations(){let e=this.auth.getUserId();e&&this.http.get("/api/messages/chat-list").subscribe(t=>d(this,null,function*(){let i=[];for(let o of t){let l=yield m(this.http.get(`/api/users/${o}`)),F=yield m(this.http.get(`/api/messages/history?user1=${e}&user2=${o}&page=0&size=1`));i.push({userId:o,username:l.username,lastMessage:F[0]?.content??""})}this.conversations=i}))}openChat(e){this.router.navigate(["/chat",e])}ngOnDestroy(){this.sub?.unsubscribe()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=f({type:n,selectors:[["app-chat-list"]],decls:4,vars:1,consts:[[1,"chat-list"],["class","chat-preview",3,"click",4,"ngFor","ngForOf"],[1,"chat-preview",3,"click"],[1,"chat-content"],[1,"chat-username"],[1,"chat-lastMessage"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"h2"),p(2,"\u804A\u5929\u5BA4"),a(),v(3,$,6,2,"div",1),a()),t&2&&(c(3),C("ngForOf",i.conversations))},dependencies:[b,w,S],styles:[".chat-list[_ngcontent-%COMP%]{padding:1rem;width:300px;border-right:1px solid #e2e8f0;background-color:#fefefe}.chat-list[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:1rem;color:#2d3748;font-weight:600}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]{padding:.75rem 1rem;border-radius:.5rem;margin-bottom:.5rem;background-color:#fff;cursor:pointer;transition:background .2s,box-shadow .2s}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]:hover{background-color:#edf2f7;box-shadow:0 2px 4px #0000000d}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;overflow:hidden}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]   .chat-username[_ngcontent-%COMP%]{font-weight:600;color:#2d3748;font-size:1rem}.chat-list[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]   .chat-lastMessage[_ngcontent-%COMP%]{font-size:.85rem;color:#718096;margin-top:.25rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:220px}"]})};export{k as a};
